<!-- Hero Section -->
<section class="hero-section">
  <div class="hero-content name-container">
    <h1 class="hero-title fade-in clickable-element" (click)="scrollToFeatured()">Find Your Dream Home</h1>
    <p class="hero-subtitle fade-in" (click)="scrollToFeatured()">Explore a wide range of properties tailored to your needs.</p>
    
    <!-- Search Container -->
    <div class="search-container slide-in">
      <!-- Simple Search -->
      <div class="search-box" [class.expanded]="showAdvancedSearch">
        <div class="simple-search">
          <i class="fas fa-search search-icon"></i>
          <input 
            type="text" 
            [(ngModel)]="searchForm.search"
            placeholder="Search here"
            class="search-input"
            (keyup.enter)="search()">
          <button class="advanced-toggle" (click)="toggleAdvancedSearch()">
            <i class="fas fa-sliders-h"></i>
          </button>
          <button class="search-button btn-gradient" (click)="search()">Search</button>
        </div>
        
        <!-- Advanced Search Fields -->
        <div class="advanced-search" *ngIf="showAdvancedSearch">
          <div class="search-row">
            <div class="search-field">
              <label>Price Range</label>
              <select [(ngModel)]="searchForm.priceRange" class="search-select">
                <option value="">Any Price</option>
                <option *ngFor="let range of priceRanges" [value]="range.value">
                  {{ range.label }}
                </option>
              </select>
            </div>
            <div class="search-field">
              <label>Property Type</label>
              <select [(ngModel)]="searchForm.propertyType" class="search-select">
                <option value="">Any Type</option>
                <option *ngFor="let type of propertyTypes" [value]="type">
                  {{ type }}
                </option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Featured Properties Section -->
<section class="featured-section" #featuredPropertiesSection id="featured-properties">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Featured Properties</h2>
      <!-- FIXED: Add refresh button for testing -->
      <button class="refresh-btn" (click)="forceRefresh()" title="Refresh Properties">
        <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i>
      </button>
    </div>

    <!-- FIXED: Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading featured properties...</p>
    </div>

    <!-- FIXED: Error State -->
    <div *ngIf="error && !isLoading" class="error-state">
      <i class="fas fa-exclamation-triangle"></i>
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="loadFeaturedProperties()">
        <i class="fas fa-redo"></i> Try Again
      </button>
    </div>

    <!-- FIXED: Properties Grid - Only show when we have properties -->
    <div *ngIf="hasFeaturedProperties() && !isLoading" class="properties-grid">
      <div *ngFor="let property of featuredProperties; trackBy: trackByPropertyId; let i = index" 
           class="property-card" 
           [routerLink]="['/properties', property.id]">
        <div class="property-image">
          <!-- FIXED: Handle case where images might be empty -->
          <img 
            [src]="property.images && property.images.length > 0 ? property.images[0] : '/assets/no-image-placeholder.jpg'" 
            [alt]="property.title" 
            loading="lazy" />
          <span class="property-badge">{{ property.propertyType }}</span>
          <!-- FIXED: Add featured badge -->
          <!-- <span class="featured-badge" *ngIf="property.featured">
            <i class="fas fa-star"></i> Featured
          </span> -->
        </div>
        <div class="property-content">
          <h3 class="property-title">{{ property.title }}</h3>
          <p class="property-description">
            {{ property.description | slice:0:50 }}{{ property.description.length > 50 ? '...' : '' }}
          </p>
          
          <div class="property-meta">
            <span class="property-location">
              <i class="fas fa-map-marker-alt"></i> {{ property.city }}, {{ property.state }}
            </span>
            <span class="property-price">{{ formatPrice(property.price) }}</span>
          </div>
          <div class="property-features">
            <span class="feature"><i class="fas fa-bed"></i> {{ property.bedrooms }} Beds</span>
            <!-- <span class="feature"><i class="fas fa-bath"></i> {{ property.bathrooms }} Baths</span> -->
            <span class="feature"><i class="fas fa-ruler-combined"></i> {{ property.squareFootage }} sqft</span>
          </div>
        </div>
      </div>
    </div>

    <!-- FIXED: No Featured Properties State -->
    <div *ngIf="!hasFeaturedProperties() && !isLoading && !error" class="no-featured-state">
      <div class="no-featured-content">
        <i class="fas fa-star"></i>
        <h3>No Featured Properties</h3>
        <p>There are currently no featured properties available.</p>
        <a routerLink="/properties" class="view-all-btn btn-gradient">
          <i class="fas fa-search"></i> Browse All Properties
        </a>
      </div>
    </div>

    <!-- View All Properties Button - Only show when we have featured properties -->
    <div *ngIf="hasFeaturedProperties() && !isLoading" class="view-all-container">
      <a routerLink="/properties" class="view-all-btn btn-gradient">
        View All Properties
        <i class="fas fa-arrow-right"></i>
      </a>
    </div>

    <!-- FIXED: Debug info (remove in production) -->
    <div *ngIf="false" class="debug-info">
      <p><strong>Debug Info:</strong></p>
      <p>Featured Properties Count: {{ featuredProperties.length || 0 }}</p>
      <p>Is Loading: {{ isLoading }}</p>
      <p>Has Error: {{ !!error }}</p>
      <p>Properties: {{ featuredProperties | json }}</p>
    </div>
  </div>
</section>