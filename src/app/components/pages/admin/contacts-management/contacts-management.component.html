<div class="contacts-management">
  <!-- Header -->
  <div class="page-header">
    <h1 class="page-title">All Messages :</h1>
    <div class="header-info">
      <span class="contact-count" *ngIf="!isLoading">{{ totalContacts }} Total Contacts</span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading contacts...</p>
  </div>

  <!-- Contact Cards -->
  <div class="contacts-grid" *ngIf="!isLoading && contacts.length > 0">
    <div class="contact-card" *ngFor="let contact of paginatedContacts; trackBy: trackByContactId">
      <div class="card-header">
        <div class="card-main-info">
          <div style="display: flex;">
            <i style="margin-top: 3px; margin-right: 6px;" class="fa-solid fa-user"></i>
          <div class="card-name">{{ contact.name }}</div>
          </div>
          <div class="card-email">
            <a [href]="'mailto:' + contact.email">{{ contact.email }}</a>
          </div>
          <div class="card-phone" *ngIf="contact.phone">
            <a [href]="'tel:' + contact.phone">{{ contact.phone }}</a>
          </div>
        </div>
        
        <div class="card-side-info">
          <div class="card-property">
            <span *ngIf="contact.propertyTitle" class="property-link">{{ contact.propertyTitle }}</span>
            <span *ngIf="!contact.propertyTitle" class="no-property">General Inquiry</span>
          </div>
          <div class="card-date">{{ formatDate(contact.createdAt) }}</div>
        </div>
      </div>
      
      <!-- <div class="card-message-preview">
        {{ contact.message }}
      </div> -->
      
      <div class="card-actions">
        <button class="action-btn view-btn" (click)="viewDetails(contact)">
          <i class="fas fa-eye"></i>
          View Full Message
        </button>
        <button class="action-btn delete-btn" (click)="confirmDelete(contact)">
          <i class="fas fa-trash"></i>
          Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="empty-state" *ngIf="contacts.length === 0 && !isLoading">
    <i class="fas fa-envelope"></i>
    <h3>No contacts found</h3>
    <p>Contact messages will appear here</p>
  </div>

  <!-- Pagination -->
  <div class="pagination-container" *ngIf="!isLoading && contacts.length > 0 && totalPages > 1">
    <div class="pagination-info">
      <span class="pagination-text">
        Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to 
        {{ getMin(currentPage * itemsPerPage, totalContacts) }} of 
        {{ totalContacts }} contacts
      </span>
    </div>
    
    <div class="pagination-controls">
      <button 
        class="pagination-btn pagination-prev" 
        (click)="previousPage()" 
        [disabled]="currentPage === 1">
        <i class="fas fa-chevron-left"></i>
        Previous
      </button>
      
      <div class="page-numbers">
        <button 
          *ngFor="let page of getPageNumbers()" 
          class="page-btn" 
          [class.active]="page === currentPage"
          (click)="goToPage(page)">
          {{ page }}
        </button>
      </div>
      
      <button 
        class="pagination-btn pagination-next" 
        (click)="nextPage()" 
        [disabled]="currentPage === totalPages">
        Next
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <!-- Delete Confirmation Dialog -->
  <div class="modal-overlay" *ngIf="showDeleteConfirm" (click)="cancelDelete()">
    <div class="delete-dialog" (click)="$event.stopPropagation()">
      <h3>Confirm Delete</h3>
      <p>Are you sure you want to delete this contact message from {{ contactToDelete?.name }}?</p>
      <div class="dialog-actions">
        <button class="cancel-btn" (click)="cancelDelete()">Cancel</button>
        <button class="confirm-delete-btn" (click)="deleteContact()">Delete</button>
      </div>
    </div>
  </div>

  <!-- Detail View Dialog -->
<div class="modal-overlay" *ngIf="showDetailDialog" (click)="closeDetailDialog()">
  <div class="detail-dialog" (click)="$event.stopPropagation()">
    <h3><i class="fa-solid fa-address-card" style="color: #2980b9;"></i>&nbsp; Contact Details</h3>
    <div class="detail-content" *ngIf="selectedContact">

      <div class="detail-item">
        <span class="detail-label">
          <i class="fa-solid fa-user"></i> Name
        </span>
        <span class="detail-value">{{ selectedContact.name }}</span>
      </div>

      <div class="detail-item">
        <span class="detail-label">
          <i class="fa-solid fa-envelope"></i> Email
        </span>
        <span class="detail-value">
          <a [href]="'mailto:' + selectedContact.email">{{ selectedContact.email }}</a>
        </span>
      </div>

      <div class="detail-item" *ngIf="selectedContact.phone">
        <span class="detail-label">
          <i class="fa-solid fa-phone"></i> Phone
        </span>
        <span class="detail-value">
          <a [href]="'tel:' + selectedContact.phone">{{ selectedContact.phone }}</a>
        </span>
      </div>

      <div class="detail-item">
        <span class="detail-label">
          <i class="fa-solid fa-building"></i> Property
        </span>
        <span class="detail-value">
          <span *ngIf="selectedContact.propertyTitle">{{ selectedContact.propertyTitle }}</span>
          <span *ngIf="!selectedContact.propertyTitle" class="no-property">General Inquiry</span>
        </span>
      </div>

      <div class="detail-item">
        <span class="detail-label">
          <i class="fa-solid fa-calendar-days"></i> Date
        </span>
        <span class="detail-value">{{ formatDate(selectedContact.createdAt) }}</span>
      </div>

      <div class="detail-item">
        <span class="detail-label">
          <i class="fa-solid fa-message"></i> Message
        </span>
        <div class="message-full">{{ selectedContact.message }}</div>
      </div>

    </div>
    <div class="dialog-actions">
      <button class="close-btn" (click)="closeDetailDialog()">
        <i class="fa-solid fa-circle-xmark"></i>&nbsp; Close
      </button>
    </div>
  </div>
</div>
